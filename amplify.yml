version: 1
frontend:
  phases:
    preBuild:
      commands:
        # Node.js 20 사용
        - nvm use 20

        # Node.js 버전 확인
        - node --version
        - npm --version

        # pnpm 설치
        - npm install -g pnpm@10.14.0
        - pnpm --version

        # 의존성 설치
        - pnpm install

        # .env.production 파일 초기화
        - echo "# Auto-generated environment variables" > .env.production

        # AUTH로 시작하는 환경 변수 추가
        - env | grep -E '^AUTH' >> .env.production || echo "No AUTH variables found"

        # NEXT로 시작하는 환경 변수 추가
        - env | grep -E '^NEXT' >> .env.production || echo "No NEXT variables found"

    build:
      commands:
        # # TypeScript 타입 체크
        # - pnpm type-check

        # # 린트 검사 (에러 시에도 계속 진행)
        # - pnpm lint || echo "Lint warnings found, but continuing build..."

        # Next.js 빌드
        - pnpm build

    postBuild:
      commands:
        # 빌드 결과 확인
        - echo "Build completed successfully"
        - ls -la .next/

  artifacts:
    baseDirectory: .next
    files:
      - '**/*'

  cache:
    paths:
      # pnpm 캐시
      - ~/.pnpm-store/**/*
      # node_modules
      - node_modules/**/*
      # Note: .next/cache 제외 - 빌드 아티팩트 불일치 방지
